{"version":3,"sources":["axios-wrapper.js"],"names":["_axios","_interopRequireDefault","require","_queryString","stringify","axios","defaults","headers","post","urlencodedHeaders","Content-Type","nullLogger","info","debug","error","toJson","string","JSON","parse","err","get","_callee","host","endpoint","options","logger","request","response","_args","arguments","regeneratorRuntime","wrap","_context","prev","next","length","undefined","config","apiDebug","console","method","url","params","requestFormatter","sent","responseFormatter","abrupt","getFullResponse","data","t0","stop","_callee2","body","_context2","transformResponse","_request","Authorization","rhAuth","startsWith","headerString","substring","txs","payload","src","e","contents","bin","xabi","message","errResponse","_options","Object","assign","queryString"],"mappings":"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","file":"axios-wrapper.js","sourcesContent":["import axios from 'axios'\nimport queryString from 'query-string'\nconst { stringify} = require('flatted/cjs');\n\n\naxios.defaults.headers.post['Content-Type'] = 'application/json'\n\nconst urlencodedHeaders = { 'Content-Type': 'application/x-www-form-urlencoded' }\nconst nullLogger = { info: () => {}, debug: () => {}, error: () => {} }\n\nfunction toJson(string) {\n  try {\n    return JSON.parse(string)\n  } catch (err) {\n    return string\n  }\n}\n\nasync function get(host, endpoint, options = {}) {\n  const logger = options.logger || (options.config.apiDebug? console : nullLogger)\n  const url = host + endpoint\n  const request = {\n    method: 'GET',\n    url,\n    headers: options.headers || null,\n    params: options.params || null,\n    transformResponse: [toJson],\n  }\n  try {\n    logger.debug('### axios GET')\n    logger.debug(requestFormatter(request))\n    const response = await axios(request)\n    logger.debug('### axios GET response')\n    logger.debug(responseFormatter(response))\n    return options.getFullResponse ? response : response.data\n  } catch (err) {\n    logger.error(errorFormatter(err))\n    logger.debug('### axios GET error')\n    logger.debug(errorFormatter(err))\n    throw err\n  }\n}\n\nasync function post(host, endpoint, body, options) {\n  const logger = options.logger || (options.config.apiDebug? console : nullLogger)\n  const url = host + endpoint\n  const request = {\n    url,\n    method: 'POST',\n    headers: options.headers || null,\n    data: body,\n    transformResponse: [toJson],\n  }\n  try {\n    logger.debug('### axios POST')\n    logger.debug(requestFormatter(request))\n    const response = await axios(request)\n    logger.debug('### axios POST response')\n    logger.debug(responseFormatter(response))\n    return options.getFullResponse ? response : response.data\n  } catch (err) {\n    logger.debug('### axios POST error')\n    logger.error(errorFormatter(err))\n    throw err\n  }\n}\n\nfunction requestFormatter(_request) {\n  const request = JSON.parse(JSON.stringify(_request)) // deep copy\n  if (request.headers && request.headers.Authorization) {\n    const rhAuth = request.headers.Authorization\n    if (rhAuth.startsWith('Bearer')) {\n      const headerString = rhAuth.substring(0, 15) + '...truncted...' + rhAuth.substring(rhAuth.length - 10)\n      request.headers.Authorization = headerString\n    }\n  }\n  // if this is a contract - remove the source from the debug\n  try {\n    request.data.txs[0].payload.src = 'source removed.'\n  } catch (e) {\n  }\n  try {\n    request.data.src = 'source removed.'\n  } catch (e) {\n  }\n  return JSON.stringify(request, null, 2)\n}\n\nfunction responseFormatter(response) {\n  // if this is a contract - remove the source from the debug\n  try {\n    response.data[0].data.contents.src = 'source removed.'\n  } catch (e) {\n  }\n  try {\n    response.data[0].data.contents.bin = 'bin removed.'\n  } catch (e) {\n  }\n  try {\n    response.data[0].data.contents['bin-runtime'] = 'bin-runtime removed.'\n  } catch (e) {\n  }\n  try {\n    response.data[0].data.contents.xabi = 'xabi removed.'\n  } catch (e) {\n  }\n  try {\n    response.data[0].data.src = 'source removed.'\n  } catch (e) {\n  }\n  if (response.data) {\n    return JSON.stringify(response.data, null, 2)\n  }\n  return JSON.stringify(response, null, 2)\n}\n\nfunction errorFormatter(err) {\n  // system error\n  if (err.syscall) return err.message\n  // rest error\n  if (err.response) {\n    const errResponse = {\n      ...err.response,\n      request: undefined,\n    }\n   return JSON.stringify(errResponse, null, 2)\n  }\n  // other\n  return stringify(err)\n}\n\nasync function postue(host, endpoint, data, _options) {\n  const options = Object.assign({}, _options)\n  options.headers = Object.assign({}, options.headers, urlencodedHeaders)\n  return post(host, endpoint, queryString.stringify(data), options)\n}\n\nexport default {\n  get,\n  post,\n  postue,\n}\n"]}