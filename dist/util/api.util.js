"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.constructEndpoint=constructEndpoint,exports.constructMetadata=constructMetadata,exports.get=get,exports.getNodeUrl=getNodeUrl,exports.post=post,exports.postue=postue,exports.setAuthHeaders=setAuthHeaders,exports.Endpoint=void 0;var _httpStatusCodes=_interopRequireDefault(require("http-status-codes")),_queryString=_interopRequireDefault(require("query-string")),_axiosWrapper=_interopRequireDefault(require("../axios-wrapper")),_rest=require("./rest.util");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function asyncGeneratorStep(t,r,e,n,o,a,c){try{var s=t[a](c),i=s.value}catch(t){return void e(t)}s.done?r(i):Promise.resolve(i).then(n,o)}function _asyncToGenerator(s){return function(){var t=this,c=arguments;return new Promise(function(r,e){var n=s.apply(t,c);function o(t){asyncGeneratorStep(n,r,e,o,a,"next",t)}function a(t){asyncGeneratorStep(n,r,e,o,a,"throw",t)}o(void 0)})}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var blocUrl="/bloc/v2.2",strato12Url="/strato-api/eth/v1.2",strato23Url="/strato/v2.3",cirrusUrl="/cirrus/search",externalStorageUrl="/apex-api/bloc/file",Endpoint={ACCOUNT:"".concat(strato12Url,"/account"),USERS:"".concat(blocUrl,"/users"),USER:"".concat(blocUrl,"/users/:username"),FILL:"".concat(blocUrl,"/users/:username/:address/fill"),STATE:"".concat(blocUrl,"/contracts/:name/:address/state"),STATES:"".concat(blocUrl,"/contracts/states"),TXRESULTS:"".concat(blocUrl,"/transactions/results"),SEND:"".concat(strato23Url,"/transaction"),KEY:"".concat(strato23Url,"/key"),SEARCH:"".concat(cirrusUrl,"/:name"),CHAIN:"".concat(blocUrl,"/chain"),CHAINS:"".concat(blocUrl,"/chains"),EXT_UPLOAD:"".concat(externalStorageUrl,"/upload"),EXT_ATTEST:"".concat(externalStorageUrl,"/attest"),EXT_VERIFY:"".concat(externalStorageUrl,"/verify"),EXT_DOWNLOAD:"".concat(externalStorageUrl,"/download"),EXT_LIST:"".concat(externalStorageUrl,"/list")};function constructEndpoint(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=Object.getOwnPropertyNames(e).reduce(function(t,r){return t.replace(":".concat(r),encodeURIComponent(e[r]))},t),o=t===Endpoint.SEARCH?constructQuerySearch(r):constructQuery(r);return"".concat(n).concat(o)}function constructQuerySearch(t){if(void 0===t)return"";var r=t.chainIds;if(void 0!==r&&void 0!==r.length&&0<r.length){if(1==r.length){var e=Object.assign({chainId:"eq.".concat(r[0])},t.query);return"?".concat(_queryString.default.stringify(e))}var n=r.join(),o=Object.assign({chainId:"in.".concat(n)},t.query);return"?".concat(_queryString.default.stringify(o))}return"?".concat(_queryString.default.stringify(t.query))}function constructQuery(t){if(void 0===t)return"";var r=Object.assign({chainid:t.chainIds},t.isAsync?{}:{resolve:!0},t.stateQuery,t.query);return"?".concat(_queryString.default.stringify(r))}function constructMetadata(t,r){var e={};if(t==={})return e;if(e.history="",t.enableHistory&&(e.history=r),t.hasOwnProperty("history")&&(Array.isArray(t.history)?e.history=0===e.history.length||0<=t.history.indexOf(e.history)?t.history.join(","):"".concat(e.history,",").concat(t.history.join(",")):_typeof(t.history)===String&&(e.history=0===e.history.length||0<=t.history.indexOf(e.history)?t.history:"".concat(e.history,",").concat(t.history))),t.hasOwnProperty("enableIndex")&&!t.enableIndex&&(e.noindex=r),t.hasOwnProperty("noindex")){var n=t.noindex.filter(function(t){return t!==r}).join();e.noindex="".concat(t.noindex,",").concat(n)}if(t.config.hasOwnProperty("VM")){if(!["EVM","SolidVM"].includes(t.config.VM))throw new _rest.RestError(_httpStatusCodes.default.BAD_REQUEST,"Illegal VM type ".concat(t.VM),{options:t});e.VM=t.config.VM}return e}function setAuthHeaders(t,r){var e=Object.assign({},r);return e.headers=Object.assign({},r.headers,{Authorization:"Bearer ".concat(t.token)}),e}function getNodeUrl(t){var r=t.node||0;return t.config.nodes[r].url}function post(t,r,e,n){return _post.apply(this,arguments)}function _post(){return(_post=_asyncToGenerator(regeneratorRuntime.mark(function t(r,e,n,o){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=function(t,r){if(Array.isArray(t))return t;var e=Object.assign({},t),n=r.config?r.config.txParams:void 0;return e.txParams=Object.assign({gasLimit:321e8,gasPrice:1},n,r.txParams,t.txParams),e}(n,o),t.abrupt("return",_axiosWrapper.default.post(r,e,a,o));case 3:case"end":return t.stop()}},t)}))).apply(this,arguments)}function get(t,r){return _get.apply(this,arguments)}function _get(){return(_get=_asyncToGenerator(regeneratorRuntime.mark(function t(r,e){var n,o=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=2<o.length&&void 0!==o[2]?o[2]:{},t.abrupt("return",_axiosWrapper.default.get(r,e,n));case 2:case"end":return t.stop()}},t)}))).apply(this,arguments)}function postue(t,r,e,n){return _postue.apply(this,arguments)}function _postue(){return(_postue=_asyncToGenerator(regeneratorRuntime.mark(function t(r,e,n,o){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_axiosWrapper.default.postue(r,e,n,o));case 1:case"end":return t.stop()}},t)}))).apply(this,arguments)}exports.Endpoint=Endpoint;
//# sourceMappingURL=api.util.js.map
